<% content_for :sidebar do %>
  <h2>Calendário</h2>
  	<div id="calendars"></div>
      <% form_tag((collection_url rescue ''), :method => :get) do -%>
	   <fieldset>
	        <legend><img src="/images/icons/calendar.png" alt="" />Datas selecionadas (<a href="javascript:void(0);" id="reset">limpar</a>)</legend>
	        <label class="x-small">Início <input type="text" name="start_date" value="<%#= @start_date.to_s_br -%>" id="start" class="textfield" /></label>
		<label class="x-small">Fim <input type="text" name="end_date" value="<%#= @end_date.to_s_br -%>" id="end" class="textfield" /></label><br />
		<label class="small lblbutton"><input type="submit" class="button" value="Filtrar" /></label>
	   </fieldset>
      <% end -%>
  <script type="text/javascript">
      new Timeframe('calendars', {
        startfield: 'start',
        endfield: 'end',
		format: '%d/%m/%Y',
        earliest: new Date(2008,1,1),
        resetbutton: 'reset' });
  </script>
<% end %>

<h2>Aulas</h2>

<p>
<%= link_to_function image_tag('icons/arrow_down.png') + 'Escolher Sala' do |page|
  page.visual_effect :toggle_appear, 'classroom_filter'
  page.visual_effect :toggle_appear, 'submit_filter_1'
  #page.visual_effect :toggle_appear, 'submit_filter_2'
end %>
|
<%= link_to_function image_tag('icons/arrow_down.png') + 'Escolher Professor' do |page|
  page.visual_effect :toggle_appear, 'teacher_filter'
  #page.visual_effect :toggle_appear, 'submit_filter_1'
  page.visual_effect :toggle_appear, 'submit_filter_2'
end %>
</p>

  <% form_tag collection_url, :method => :get do -%>
    <fieldset>
      <label id="classroom_filter" style="display: none;">
        <%= select_tag :classroom_id, 
          "<option value="">Selecione</option>" +
          options_from_collection_for_select(Classroom.find(:all), :id, :name, params[:classroom_id].to_i) %>
      </label>

      <label id="teacher_filter" style="display: none;">
        <%= select_tag :teacher_id, 
          "<option value="">Selecione</option>" +
          options_from_collection_for_select(Teacher.find(:all), :id, :name, params[:teacher_id].to_i) %>
      </label>

      <label class="x-small lblbutton" id="submit_filter_1" style="display: none;"><input type="submit" class="button" value="Filtrar" /></label>
      <label class="x-small lblbutton" id="submit_filter_2" style="display: none;"><input type="submit" class="button" value="Filtrar" /></label>
    </fieldset>
  <% end %>
  
<h5>Período de <%= @start_date.to_s_br %> a <%= @end_date.to_s_br %></h5>

<% unless params[:classroom_id].blank? %>
  <h5>Sala: <%= Classroom.find params[:classroom_id] %></h5>
<% end %>

<% unless params[:teacher_id].blank? %>
  <h5>Professor: <%= Teacher.find params[:teacher_id] %></h5>
<% end %>

<table border="1" class="calendar">
  
  <tr>
    <% ["Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado"].each do |day| -%>
      <th><%= day %></th>
    <% end -%>
  </tr>
  
  <% ((@start_date.beginning_of_week - 1.day)..@end_date).to_a.in_groups_of(7) do |week| -%>
    <tr>
      <% week.each do |date| -%>
        <th><%= date.to_s_br if date && (date >= @start_date) %></th>
      <% end -%>
    </tr>
  
    <tr class="lesson">
      <% week.each do |date| -%>
        <td>
          <% if date.blank? || date && (date < @start_date) %>
            <div class="empty">&nbsp;</div>
          <% else %>
            <div>
              <% lessons = @lessons.select {|lesson| lesson.date == date } %>
              <% lessons.each do |lesson| %>
                <span>
                  <%=link_to lesson.to_calendar, edit_object_url(lesson) %>
                  - 
                  <%=link_to 'X', object_url(lesson), :confirm => 'Are you sure?', :method => :delete %>
                </span>
              <% end %>
              <span>
                <% #= link_to 'Nova Aula', new_object_url.merge(:lesson => {:datetime_start => @start_date}) %>
                <%= link_to 'Nova Aula', new_lesson_url(:lesson => {:date => date}) %>
              </span>
            </div>      
          <% end %>
        </td>
      <% end -%>
    </tr>
  <% end -%>

</table>
